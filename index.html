<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BlattaLab｜蜚蠊介紹與販售</title>
  <meta name="description" content="BlattaLab 專注於蜚蠊（Blattodea）的研究、繁育與教育推廣。提供科學化的物種資訊與飼養建議，並提供購買服務。" />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#0e1012;--panel:#15181c;--muted:#9aa4af;--text:#e6ebf0;--brand:#21c48c;--brand-2:#15a17c;--ring:#2a343f;--card:#121418;--accent:#2b3947;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans",sans-serif;letter-spacing:.2px;background:linear-gradient(180deg,#0b0d10, #0f1317 30%, #0b0d10);color:var(--text)}
    a{color:inherit}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    header{position:sticky;top:0;z-index:30;background:rgba(18,20,24,.8);backdrop-filter:blur(10px);border-bottom:1px solid var(--ring)}
    .nav{display:flex;align-items:center;gap:16px;padding:12px 24px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .logo{width:32px;height:32px;border-radius:10px;background:conic-gradient(from 210deg at 50% 50%,#21c48c, #1b9a86, #15607a,#203241,#21c48c);display:grid;place-items:center;box-shadow:0 0 0 1px #2b3642 inset,0 10px 30px rgba(0,0,0,.35)}
    .logo svg{width:22px;height:22px;fill:#0e1012}
    .nav a{padding:8px 10px;border-radius:10px;color:var(--muted);text-decoration:none;transition:.2s}
    .nav a:hover{color:var(--text);background:var(--panel)}

    .hero{padding:56px 24px 8px}
    .hero h1{font-size:40px;margin:0 0 8px}
    .hero p{margin:0;color:var(--muted)}

    .toolbar{display:flex;flex-wrap:wrap;gap:12px;align-items:center;background:var(--panel);border:1px solid var(--ring);padding:12px;border-radius:14px;margin:18px 0}
    .toolbar input,.toolbar select{background:#0f1216;border:1px solid var(--ring);color:var(--text);padding:10px 12px;border-radius:10px;outline:none}
    .toolbar .chip{padding:8px 10px;border:1px solid var(--ring);border-radius:999px;cursor:pointer;color:var(--muted)}
    .toolbar .chip.active{background:var(--accent);color:var(--text)}

    .genus-tabs{display:flex;gap:8px;flex-wrap:wrap;margin:18px 0}
    .tab{padding:10px 14px;border:1px solid var(--ring);border-radius:12px;color:var(--muted);cursor:pointer;background:var(--panel)}
    .tab.active{background:linear-gradient(180deg,#1a232d,#14202a);color:var(--text);border-color:#324150}

    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    @media (max-width:1000px){.grid{grid-template-columns:repeat(8,1fr)}}
    @media (max-width:720px){.grid{grid-template-columns:repeat(4,1fr)}}

    .card{grid-column:span 4;background:var(--card);border:1px solid var(--ring);border-radius:18px;overflow:hidden;display:flex;flex-direction:column}
    .thumb{aspect-ratio:16/10;background:linear-gradient(135deg,#1a2732,#0e1620);display:grid;place-items:center}
    .thumb .ph{font-size:12px;color:var(--muted);border:1px dashed #334152;padding:8px 10px;border-radius:10px}
    .card-body{padding:14px 14px 12px;display:flex;flex-direction:column;gap:8px}
    .latin{font-weight:700}
    .cn{color:var(--muted)}
    .meta{display:flex;flex-wrap:wrap;gap:8px}
    .tag{font-size:12px;padding:6px 8px;border:1px solid var(--ring);border-radius:999px;color:var(--muted)}
    .row{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:14px}
    .stars{display:inline-flex;gap:2px;vertical-align:middle}
    .stars svg{width:16px;height:16px}
    .buy{margin-top:auto;display:flex;gap:8px}
    .btn{flex:1;text-align:center;text-decoration:none;padding:10px 12px;border-radius:12px;border:1px solid #2e3b48;background:linear-gradient(180deg,#1a232d,#121820);color:#d5dee7;font-weight:600}
    .btn:hover{border-color:#3a4958}
    .btn.primary{background:linear-gradient(180deg,#23c48c,#1aa67e);border-color:#25b588;color:#07110e}

    .section-title{display:flex;justify-content:space-between;align-items:center;margin:24px 0 8px}
    .section-title h2{margin:0;font-size:20px;color:#dce6ef}
    .count{color:var(--muted);font-size:14px}

    footer{margin-top:40px;border-top:1px solid var(--ring);padding:20px 24px;color:var(--muted)}
    .note{font-size:12px;color:var(--muted)}

    /* Modal 彈窗樣式 */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      z-index: 1000;
    }

    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: var(--card);
      border: 1px solid var(--ring);
      border-radius: 20px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      padding: 20px 24px 16px;
      border-bottom: 1px solid var(--ring);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
    }

    .modal-title {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      color: var(--text);
      line-height: 1.3;
    }

    .modal-subtitle {
      margin: 4px 0 0 0;
      font-size: 14px;
      color: var(--muted);
    }

    .close-btn {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .close-btn:hover {
      background: var(--ring);
      color: var(--text);
    }

    .modal-body {
      padding: 20px 24px 24px;
    }

    .modal-image {
      width: 100%;
      aspect-ratio: 16/10;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 16px;
    }

    .modal-info {
      display: grid;
      gap: 12px;
    }

    .info-row {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 12px;
      align-items: start;
    }

    .info-label {
      font-size: 13px;
      color: var(--brand);
      font-weight: 600;
      white-space: nowrap;
    }

    .info-value {
      font-size: 14px;
      color: var(--text);
      line-height: 1.4;
    }

    .modal-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .modal-tag {
      font-size: 11px;
      padding: 4px 8px;
      border: 1px solid var(--ring);
      border-radius: 999px;
      color: var(--muted);
      background: var(--panel);
    }

    .modal-difficulty {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* 手機版響應式補丁 */
    @media (max-width: 720px) {
      .grid {
        grid-template-columns: 1fr !important; /* 手機版單欄 */
        gap: 16px;
      }
      
      .card {
        grid-column: span 1 !important;
        margin: 0 8px; /* 左右留白 */
        overflow: hidden; /* 確保圖片不會超出卡片 */
      }
      
      .thumb {
        aspect-ratio: 16/10; /* 保持原比例但限制高度 */
        max-height: 200px; /* 限制最大高度 */
        overflow: hidden;
        width: 100%; /* 確保填滿整個寬度 */
        margin: 0 !important; /* 移除任何邊距 */
        padding: 0 !important; /* 移除任何內距 */
        border-radius: 0; /* 移除圖片區域的圓角 */
        background: none !important; /* 移除預設背景 */
        display: block !important; /* 改為 block 而非 grid */
      }
      
      .thumb img {
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
        object-position: center !important;
        display: block; /* 移除 inline 間距 */
        margin: 0;
        padding: 0;
        border-radius: 0; /* 圖片本身不要圓角 */
      }
      
      .card-body {
        padding: 12px !important;
        gap: 6px !important;
      }
      
      .latin {
        font-size: 16px !important;
        line-height: 1.3;
      }
      
      .cn {
        font-size: 14px !important;
        line-height: 1.3;
        margin-top: 2px;
      }
      
      .meta {
        gap: 6px !important;
        margin: 8px 0 !important;
      }
      
      .tag {
        font-size: 11px !important;
        padding: 4px 8px !important;
        line-height: 1.2;
      }
      
      .row {
        font-size: 13px !important;
        gap: 8px !important;
        margin: 4px 0;
        flex-wrap: wrap;
      }
      
      .stars svg {
        width: 14px !important;
        height: 14px !important;
      }
      
      .buy {
        gap: 8px !important;
        margin-top: 12px !important;
      }
      
      .btn {
        font-size: 13px !important;
        padding: 10px 8px !important;
        border-radius: 10px !important;
      }

      /* Modal 手機版調整 */
      .modal-content {
        width: 95%;
        margin: 20px;
      }

      .modal-header {
        padding: 16px 20px 12px;
      }

      .modal-title {
        font-size: 16px;
      }

      .modal-body {
        padding: 16px 20px 20px;
      }

      .info-row {
        grid-template-columns: 1fr;
        gap: 4px;
      }

      .info-label {
        font-size: 12px;
      }

      .info-value {
        font-size: 13px;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 12px !important;
      }
      
      .card {
        margin: 0 4px !important;
      }
      
      .thumb {
        max-height: 180px !important;
      }
      
      .latin {
        font-size: 15px !important;
      }
      
      .cn {
        font-size: 13px !important;
      }
      
      .tag {
        font-size: 10px !important;
        padding: 3px 6px !important;
      }
      
      .row {
        font-size: 12px !important;
      }
      
      .btn {
        font-size: 12px !important;
        padding: 9px 6px !important;
      }
    }

    /* 修改後的 .logo 樣式 */
    .logo {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      overflow: hidden;
      box-shadow: 0 3px 15px rgba(0,0,0,.4);
    }

    .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.2s ease;
    }

    .logo:hover img {
      transform: scale(1.05);
    }
  </style>

<!-- 修改後的 HTML 結構 (在 header 部分) -->
<header>
  <div class="nav container">
    <div class="brand" aria-label="BlattaLab 標誌">
      <div class="logo" aria-hidden="true">
        <img src="images/logo.png" alt="BlattaLab Logo" />
      </div>
      <span>BlattaLab</span>
    </div>
    <nav style="margin-left:auto;display:flex;gap:8px;flex-wrap:wrap">
      <a href="#home">首頁</a>
      <a href="#genus">屬別瀏覽</a>
      <a href="#guide">飼養指南</a>
      <a href="#about">關於我們</a>
    </nav>
  </div>
</header>
  
  <main id="home" class="container">
    <section class="hero" aria-labelledby="hero-title">
      <h1 id="hero-title">蜚蠊的科學與美學</h1>
      <p>從 Blattodea 到 Lab —— 以研究級資料與設計，呈現蜚蠊的生態價值與飼養知識。</p>
    </section>

    <section class="toolbar" aria-label="篩選工具">
      <input id="q" type="search" placeholder="搜尋學名 / 中文名 / 關鍵字…" aria-label="搜尋物種" />
      <select id="difficulty" aria-label="飼養難度">
        <option value="">難度：不限</option>
        <option value="1">★☆☆☆☆（新手）</option>
        <option value="2">★★☆☆☆</option>
        <option value="3">★★★☆☆</option>
        <option value="4">★★★★☆</option>
        <option value="5">★★★★★（進階）</option>
      </select>
      <div class="chip" data-tag="地棲" role="button" tabindex="0">地棲</div>
      <div class="chip" data-tag="樹棲" role="button" tabindex="0">樹棲</div>
      <div class="chip" data-tag="穴棲" role="button" tabindex="0">穴棲</div>
    </section>

    <section id="genus">
      <div class="genus-tabs" role="tablist" aria-label="屬別">
        <!-- JS 生成屬別標籤 -->
      </div>

      <div class="section-title">
        <h2 id="section-title">全部物種</h2>
        <div class="count" id="count">0 筆</div>
      </div>

      <div class="grid" id="grid" aria-live="polite">
        <!-- JS 生成卡片 -->
      </div>
    </section>

    <section id="guide" class="container" style="margin-top:28px">
      <div class="section-title"><h2>飼養指南（重點）</h2></div>
      <ul style="margin:0;padding-left:20px;color:var(--muted)">
        <li>溫濕度：多數種 24–28°C；濕度依種 60–80%。提供乾濕梯度以避免脫皮不良。</li>
        <li>底材：地棲種偏枯葉/腐植；穴棲如 <em>Macropanesthia</em> 需厚底材挖掘；樹棲如 <em>Gyna / Eucorydia</em> 注重通風。</li>
        <li>營養：蔬果＋寵物乾糧可做為為基礎糧食；冠蠊屬及绀蠊屬（<em>Pseudoglomeris, Eucorydia</em>）須補充花粉/蜂蜜水。</li>
      </ul>
    </section>

    <!-- 修改後的 About 區段 -->
<section id="about" class="container" style="margin-top:28px">
  <div class="section-title"><h2>關於 BlattaLab</h2></div>
  
  <!-- 加入品牌視覺元素 -->
  <div class="about-content" style="display: flex; gap: 24px; align-items: flex-start; margin-top: 16px;">
    
    <!-- Logo 視覺元素 -->
    <div class="about-logo" style="flex-shrink: 0;">
      <img src="images/logo.png" alt="BlattaLab Logo" style="
        width: 100px; 
        height: 100px; 
        border-radius: 16px; 
        box-shadow: 0 8px 24px rgba(33, 196, 140, 0.15);
        border: 2px solid rgba(33, 196, 140, 0.2);
      " />
    </div>
    
    <!-- 品牌說明文字 -->
    <div class="about-text" style="flex: 1;">
      <p style="color:var(--muted);max-width:80ch;margin:0 0 16px 0;">
        品牌命名自蜚蠊目（Blattodea）與實驗室（Lab）。我們致力於以科學方法呈現蜚蠊的多樣性與生態功能，並提供穩定的飼養與教育服務。
      </p>
      
      <!-- 品牌理念 -->
      <div style="background: var(--panel); padding: 16px; border-radius: 12px; border: 1px solid var(--ring);">
        <h3 style="margin: 0 0 8px 0; font-size: 14px; color: var(--brand); font-weight: 600;">品牌理念</h3>
        <p style="margin: 0; font-size: 14px; color: var(--muted); line-height: 1.5;">
          結合科學研究的態度與實驗室的標準，BlattaLab 不僅是蜚蠊愛好者的知識寶庫，更是連接學術研究與大眾教育的橋樑。每一個物種資訊都經過仔細驗證，每一份飼養建議都源於實際經驗。
        </p>
      </div>
    </div>
  </div>
</section>

<!-- 響應式調整 CSS -->
<style>
/* 響應式設計：小螢幕時改為垂直排列 */
@media (max-width: 768px) {
  .about-content {
    flex-direction: column !important;
    text-align: center;
  }
  
  .about-logo {
    align-self: center;
  }
  
  .about-logo img {
    width: 64px !important;
    height: 64px !important;
  }
}

/* Logo hover 效果 */
.about-logo img {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.about-logo img:hover {
  transform: scale(1.05);
  box-shadow: 0 12px 32px rgba(33, 196, 140, 0.25);
}
</style>

  </main>

  <footer class="container">
    <div>© <span id="year"></span> BlattaLab. All rights reserved.</div>
  </footer>

  <!-- Modal 彈窗 -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <h2 class="modal-title" id="modal-title"></h2>
          <p class="modal-subtitle" id="modal-subtitle"></p>
        </div>
        <button class="close-btn" id="close-modal" aria-label="關閉">&times;</button>
      </div>
      <div class="modal-body">
        <img id="modal-image" class="modal-image" alt="" style="display: none;" />
        <div class="modal-info" id="modal-info">
          <!-- JS 生成內容 -->
        </div>
      </div>
    </div>
  </div>

  <template id="card-tpl">
    <article class="card" data-genus="" data-tags="">
      <div class="thumb" aria-hidden="true"><div class="ph">待補圖片</div></div>
      <div class="card-body">
        <div class="latin"></div>
        <div class="cn"></div>
        <div class="meta"></div>
        <div class="row temp"></div>
        <div class="row diet"></div>
        <div class="row diff"></div>
        <div class="buy">
          <a class="btn" target="_blank" rel="noopener">物種介紹</a>
          <a class="btn primary" target="_blank" rel="noopener">購買連結</a>
        </div>
      </div>
    </article>
  </template>

  <script>
    const STORE_URL = "https://myship.7-11.com.tw/general/detail/GM2508133179359";

    const DATA = [
      // 鼈蠊屬
      {genus:"Therea", species:"olegrandjeani", latin:"Therea olegrandjeani", cn:"問號蜚蠊", features:"黑底翅面中央白色問號狀斑紋", origin:"印度", habit:"此物種為地棲性，幼蟲與成蟲都會將大部分時間埋藏在底材中。成年雄性有時會爬到地表的樹枝上活動 。雌性將卵鞘直接產在底材中，孵化時間約需三到五個月", diet:"高蛋白犬/貓/雞飼料，幼蟲取食落葉，但不是必要條件", temp:"24–30°C；60–80%（需乾濕分明）", diff:2, tags:["地棲","新手+"], info:"需提供濕度梯度以避免脫皮不良", img:"/Cockroach/images/IMG20181211214008.jpg"},
      {genus:"Therea", species:"bernhardti", latin:"Therea bernhardti", cn:"多米諾骨牌蜚蠊", features:"黑底白圓斑，似骨牌", origin:"印度", habit:"此物種為地棲性，幼蟲與成蟲都會將大部分時間埋藏在底材中。成年雄性有時會爬到地表的樹枝上活動 。雌性將卵鞘直接產在底材中，孵化時間約需三到五個月。", diet:"高蛋白犬/貓/雞飼料，幼蟲取食落葉，但不是必要條件", temp:"24–30°C；60–70%", diff:1, tags:["地棲","新手友善"], info:"適應性強，對環境要求低", img:"/Cockroach/images/IMG_9342.JPG"},
      {genus:"Therea", species:"regularis", latin:"Therea regularis", cn:"多米諾橘骨牌蜚蠊", features:"黑底搭配橘白斑，對比強烈", origin:"印度", habit:"此物種為地棲性，幼蟲與成蟲都會將大部分時間埋藏在底材中。成年雄性有時會爬到地表的樹枝上活動 。雌性將卵鞘直接產在底材中，孵化時間約需三到五個月", diet:"高蛋白犬/貓/雞飼料，幼蟲取食落葉，但不是必要條件", temp:"24–30°C；60–70%", diff:1, tags:["地棲","新手友善"], info:"容錯率高，新手適合", img:"/Cockroach/images/IMG_9157.JPG"},
      {genus:"Therea", species:"cf_irreperta", latin:"Therea cf. irreperta", cn:"Therea cf. irreperta", features:"黑底對稱橘斑，與橘骨牌相似", origin:"印度", habit:" 屬於地棲性物種，日間潛伏於底材中，夜間才會出來活動 。此物種在同屬中較為特殊，因為雌雄兩性皆具備相對較長的翅膀，且有飛行能力", diet:"高蛋白犬/貓/雞飼料，幼蟲會取食落葉，但不是必要條件", temp:"24–30°C；需乾濕交界區", diff:2, tags:["地棲"], info:"底材濕度控制重要", img:"/Cockroach/images/IMG_9452.JPG"},

      // 瓷蠊屬
      {genus:"Gyna", species:"caffrorum", latin:"Gyna caffrorum", cn:"卡佛爾瓷蠊", features:"淡米至淺棕翅，細緻斑紋", origin:"南非", habit:"成蟲具備攀爬光滑表面和飛行的能力，但牠們更喜歡將時間花在底材下，幼蟲則完全無法攀爬光滑表面", diet:"雜食性，高蛋白飼料、蔬果、落葉", temp:"24–28°C；60–70%", diff:1, tags:["地棲","新手友善"], info:"生命週期穩定、適應力佳", img:"/Cockroach/images/Snapseed.jpg"},
      {genus:"Gyna", species:"centurio", latin:"Gyna centurio", cn:"百夫長瓷蠊", features:"雌雄二型明顯，雄米白、雌深褐斑為主", origin:"非洲中部", habit:"成蟲同樣具備攀爬光滑表面和飛行的能力，但相較於卡佛爾瓷蠊，本種速度較慢", diet:"雜食性，高蛋白飼料、蔬果、落葉", temp:"24–28°C；60–70%", diff:1, tags:["地棲","新手友善"], info:"繁殖容易，環境要求低", img:"/Cockroach/images/IMG_7931.JPG"},

      // 馬島群
      {genus:"Princisia", species:"vanwaerebeki", latin:"Princisia vanwaerebeki", cn:"巨人馬島蜚蠊", features:"大型黑至深棕，空間足可達8公分", origin:"馬達加斯加", habit:"雄性頭胸背板有誇張的突起，類似三角龍的頭飾，用於在競爭中推擠其他雄性以確立交配權，為卵胎生，雌性會在體內孵化卵鞘後產下活體幼蟲", diet:"廣泛雜食，蔬果、高蛋白飼料、肉類等 ", temp:"27°C 以上；70–80% 高濕且通風佳", diff:3, tags:["地棲"], info:"需保持濕度與通風平衡及大空間", img:"/Cockroach/images/IMG_9453.JPG"},
      {genus:"Elliptorhina", species:"chopardi", latin:"Elliptorhina chopardi", cn:"侏儒馬島蜚蠊", features:"最小馬島，<4 公分，橙褐與黑相間", origin:"馬達加斯加", habit:"為卵胎生，雌性會在體內孵化卵鞘後產下活體幼蟲", diet:"廣泛雜食，蔬果、高蛋白飼料、肉類等 ", temp:"24–28°C；70–80%", diff:2, tags:["地棲"], info:"需穩定濕度與通風", img:"/Cockroach/images/IMG_7399.JPG"},
      {genus:"Aeluropoda", species:"insignis", latin:"Aeluropoda insignis", cn:"紅平板馬島蜚蠊", features:"紅褐色平板狀、扁平化", origin:"馬達加斯加", habit:"其極度扁平的體型使其能夠有效地藏匿於狹窄的縫隙中，為卵胎生，雌性會在體內孵化卵鞘後產下活體幼蟲", diet:"雜食性，偏好蔬果，亦取食高蛋白飼料 ", temp:"24–28°C；65–75%", diff:2, tags:["地棲"], info:"需穩定濕度與隱蔽空間", img:"/Cockroach/images/IMG_9450.JPG"},

      // 金屬蠊屬
      {genus:"Pseudoglomeris", species:"magnifica", latin:"Pseudoglomeris magnifica", cn:"越南金屬蜚蠊", features:"金綠金屬光澤，極為華麗", origin:"越南 Cuc Phuong（產地型）", habit:"罕見的日行性蜚蠊，在白天會活躍地四處探索和覓食。為樹棲性物種，能夠攀爬光滑的表面，成年雄性有翅膀，能夠飛行，而雌性則無翅", diet:"食花粉性，花粉、水果、昆蟲果凍、高蛋白飼料", temp:"24–27°C；50-70%（需通風）", diff:4, tags:["樹棲"], info:"需花粉與新鮮蔬果補充", img:"/Cockroach/images/IMG_7950.JPG"},

      // 紺蠊屬
      {genus:"Eucorydia", species:"dasytoides", latin:"Eucorydia dasytoides", cn:"帶紋绀蠊", features:"亮藍金屬色翼帶黃條", origin:"東南亞（含臺灣部分）", habit:"成年雄性飛行能力佳，具有訪花行為，但壽命較短。雌蟲和若蟲多躲藏於樹皮裂縫或腐木之中", diet:"成蟲食花粉性，取食花粉、水果；幼蟲雜食", temp:"24–27°C；70–80%", diff:3, tags:["樹棲"], info:"生命週期長，成蟲期短；雄蟲需供應花粉", img:"images/IMG_7960.JPG"},
      {genus:"Eucorydia", species:"yasumatsui", latin:"Eucorydia yasumatsui", cn:"安松氏绀蠊", features:"藍黑金屬光澤翅", origin:"日本琉球群島", habit:"成年雄性飛行能力佳，具有訪花行為，但壽命較短。雌蟲和若蟲多躲藏於樹皮裂縫或腐木之中", diet:"成蟲食花粉性，取食花粉、水果；幼蟲雜食", temp:"24–27°C；70–80%", diff:3, tags:["樹棲"], info:"生命週期長，成蟲期短；雄蟲需供應花粉"},

      // 犀牛
      {genus:"Macropanesthia", species:"rhinoceros", latin:"Macropanesthia rhinoceros", cn:"犀牛蜚蠊", features:"世界上最重的蜚蠊；重要營養循環者；有複雜親代撫育行為", origin:"澳洲昆士蘭", habit:"以挖掘永久性地下洞穴而聞名，洞穴深度可達一公尺。雄性會使用其鏟狀的頭部盾牌在洞口與其他雄性打鬥，以捍衛領地。此物種有獨特的親代撫育行為，雌性會產下活體幼蟲並照顧其長達數月", diet:"乾燥桉樹葉為主，輔以蘋果、狗糧、蔬果", temp:"22–26°C；60–75%（厚底材可挖）", diff:5, tags:["穴棲","進階"], info:"生長周期極長、食材有特定需求", img:"images/IMG_9456.JPG"}
    ];

    const genusOrder = [
      "Therea","Gyna","Princisia","Elliptorhina","Aeluropoda","Pseudoglomeris","Eucorydia","Macropanesthia"
    ];

    const $grid = document.getElementById('grid');
    const $count = document.getElementById('count');
    const $tabs = document.querySelector('.genus-tabs');
    const $q = document.getElementById('q');
    const $difficulty = document.getElementById('difficulty');
    const $chips = Array.from(document.querySelectorAll('.chip'));

    // Modal 元素
    const $modal = document.getElementById('modal');
    const $modalTitle = document.getElementById('modal-title');
    const $modalSubtitle = document.getElementById('modal-subtitle');
    const $modalImage = document.getElementById('modal-image');
    const $modalInfo = document.getElementById('modal-info');
    const $closeModal = document.getElementById('close-modal');

    function starSVG(fill){
      return `<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="${fill? '#f3c96a':'#3a4653'}" d="M12 17.3l-6.1 3.6 1.6-6.9L2 8.9l7-.6L12 1.9l3 6.4 7 .6-5.5 5.1 1.6 6.9z"/></svg>`
    }

    function showModal(item) {
      $modalTitle.textContent = item.latin;
      $modalSubtitle.textContent = item.cn;

      // 設置圖片
      if (item.img) {
        $modalImage.src = item.img;
        $modalImage.alt = item.cn;
        $modalImage.style.display = 'block';
        $modalImage.onerror = function() {
          this.style.display = 'none';
        };
      } else {
        $modalImage.style.display = 'none';
      }

      // 生成詳細資訊
      $modalInfo.innerHTML = `
        <div class="info-row">
          <div class="info-label">產地</div>
          <div class="info-value">${item.origin}</div>
        </div>
        <div class="info-row">
          <div class="info-label">特徵</div>
          <div class="info-value">${item.features}</div>
        </div>
        <div class="info-row">
          <div class="info-label">習性</div>
          <div class="info-value">${item.habit}</div>
        </div>
        <div class="info-row">
          <div class="info-label">溫濕度</div>
          <div class="info-value">${item.temp}</div>
        </div>
        <div class="info-row">
          <div class="info-label">食性</div>
          <div class="info-value">${item.diet}</div>
        </div>
        <div class="info-row">
          <div class="info-label">飼養難度</div>
          <div class="info-value modal-difficulty">
            <span class="stars" aria-label="飼養難度 ${'★'.repeat(item.diff)}${'☆'.repeat(5-item.diff)}">
              ${Array.from({length:5},(_,i)=>starSVG(i<item.diff)).join('')}
            </span>
          </div>
        </div>
        <div class="info-row">
          <div class="info-label">標籤</div>
          <div class="info-value">
            <div class="modal-tags">
              ${item.tags.map(tag => `<span class="modal-tag">${tag}</span>`).join('')}
            </div>
          </div>
        </div>
        <div class="info-row">
          <div class="info-label">重點提示</div>
          <div class="info-value">${item.info}</div>
        </div>
      `;

      // 顯示 Modal
      $modal.classList.add('show');
      $modal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden'; // 防止背景滾動
    }

    function hideModal() {
      $modal.classList.remove('show');
      $modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = ''; // 恢復背景滾動
    }

    // Modal 事件監聽器
    $closeModal.addEventListener('click', hideModal);
    $modal.addEventListener('click', (e) => {
      if (e.target === $modal) { // 點擊背景關閉
        hideModal();
      }
    });

    // ESC 鍵關閉 Modal
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && $modal.classList.contains('show')) {
        hideModal();
      }
    });

    function makeCard(item){
      const tpl = document.getElementById('card-tpl');
      const node = tpl.content.firstElementChild.cloneNode(true);
      node.dataset.genus = item.genus;
      node.dataset.tags = item.tags.join(',');

      const thumb = node.querySelector('.thumb');
      if (item.img) {
        const img = document.createElement('img');
        img.src = item.img;
        img.alt = item.cn;
        img.style.cssText = 'width:100%;height:100%;object-fit:cover;border-radius:18px 18px 0 0;';

        img.onerror = function() {
          this.style.display = 'none';
          thumb.innerHTML = '<div class="ph">圖片載入失敗</div>';
        };

        thumb.innerHTML = '';
        thumb.appendChild(img);
      }
      
      node.querySelector('.latin').textContent = `${item.latin}`;
      node.querySelector('.cn').textContent = item.cn;
      const meta = node.querySelector('.meta');
      meta.innerHTML = `
        <span class="tag">產地：${item.origin}</span>
        <span class="tag">習性：${item.habit}</span>
        <span class="tag">特徵：${item.features}</span>
      `;
      node.querySelector('.temp').textContent = `溫濕度：${item.temp}`;
      node.querySelector('.diet').textContent = `食性：${item.diet}`;

      const diffRow = node.querySelector('.diff');
      diffRow.innerHTML = `難度：<span class="stars" aria-label="飼養難度 ${'★'.repeat(item.diff)}${'☆'.repeat(5-item.diff)}">${Array.from({length:5},(_,i)=>starSVG(i<item.diff)).join('')}</span>`;

      const [btnInfo, btnBuy] = node.querySelectorAll('.buy .btn');
      btnInfo.href = `#${item.genus}-${item.species}`;
      btnInfo.addEventListener('click', e=>{
        e.preventDefault();
        showModal(item); // 使用新的 Modal 函數
      });
      btnBuy.href = STORE_URL;
      btnBuy.setAttribute('aria-label', `${item.latin} 購買連結`);
      return node;
    }

    function render(genusFilter, query, diffFilter, tagSet){
      $grid.innerHTML = '';
      let list = [...DATA];
      if(genusFilter && genusFilter!=="ALL") list = list.filter(x=>x.genus===genusFilter);
      if(query){
        const q = query.trim().toLowerCase();
        list = list.filter(x => `${x.latin} ${x.cn} ${x.features} ${x.habit} ${x.origin}`.toLowerCase().includes(q));
      }
      if(diffFilter){
        list = list.filter(x=> x.diff === Number(diffFilter));
      }
      if(tagSet.size){
        list = list.filter(x=> x.tags.some(t=> tagSet.has(t)));
      }
      list.forEach(item=> $grid.appendChild(makeCard(item)));
      $count.textContent = `${list.length} 筆`;
      const title = document.getElementById('section-title');
      title.textContent = genusFilter && genusFilter!=="ALL" ? `${genusFilter} 屬` : '全部物種';
    }

    function buildTabs(){
      const uniq = Array.from(new Set(DATA.map(x=>x.genus)));
      const ordered = genusOrder.filter(g=>uniq.includes(g)).concat(uniq.filter(g=>!genusOrder.includes(g)));
      const all = document.createElement('button'); all.className='tab active'; all.role='tab'; all.textContent='全部'; all.dataset.genus='ALL';
      $tabs.appendChild(all);
      ordered.forEach(g=>{
        const b = document.createElement('button');
        b.className='tab'; b.role='tab'; b.dataset.genus=g; b.textContent=g;
        $tabs.appendChild(b);
      });
    }

    function initFilters(){
      const activeTags = new Set();
      let activeGenus = 'ALL';

      function sync(){
        render(activeGenus, $q.value, $difficulty.value, activeTags);
        document.querySelectorAll('.tab').forEach(t=>{
          t.classList.toggle('active', t.dataset.genus===activeGenus);
        });
        document.querySelectorAll('.chip').forEach(c=>{
          c.classList.toggle('active', activeTags.has(c.dataset.tag));
        });
        const hash = `#g=${encodeURIComponent(activeGenus)}&q=${encodeURIComponent($q.value)}&d=${$difficulty.value}&t=${encodeURIComponent([...activeTags].join(','))}`;
        history.replaceState(null,'',hash);
      }

      $tabs.addEventListener('click', e=>{
        const btn = e.target.closest('.tab'); if(!btn) return; activeGenus = btn.dataset.genus; sync();
      });
      $q.addEventListener('input', sync);
      $difficulty.addEventListener('change', sync);
      $chips.forEach(c=>{
        c.addEventListener('click', ()=>{ const k=c.dataset.tag; activeTags.has(k)?activeTags.delete(k):activeTags.add(k); sync(); });
        c.addEventListener('keydown', (ev)=>{ if(ev.key==='Enter' || ev.key===' '){ ev.preventDefault(); c.click(); } });
      });

      // restore from hash
      const params = new URLSearchParams(location.hash.replace(/^#/,''));
      const g = params.get('g'); const q=params.get('q'); const d=params.get('d'); const t=params.get('t');
      if(g){ activeGenus = decodeURIComponent(g); }
      if(q){ $q.value = decodeURIComponent(q); }
      if(d){ $difficulty.value = d; }
      if(t){ decodeURIComponent(t).split(',').filter(Boolean).forEach(x=>activeTags.add(x)); }

      sync();
    }

    function init(){
      document.getElementById('year').textContent = new Date().getFullYear();
      buildTabs();
      initFilters();
    }

    init();
  </script>
</body>
</html>
